# ุฅุตูุงุญ ุชุญุฏูุซ ุฃุณุนุงุฑ ุงูููุชุฌุงุช ุจูุญุฏุงุช ูุฎุชููุฉ

## ุงููุดููุฉ:

ุนูุฏ ุฅุถุงูุฉ ูุงุชูุฑุฉ ุชุญุชูู ุนูู ููุณ ุงูููุชุฌ ุจูุญุฏุงุช ูุฎุชููุฉ (ูุทุนุฉุ ุจุงููุชุ ูุฑุชูู)ุ ูุงู ุงููุธุงู ูุญุฏุซ ุณุนุฑ ุงูุชูููุฉ ุจูุงุกู ุนูู **ุขุฎุฑ ุจูุฏ** ูู ุงููุงุชูุฑุฉ.

### ูุซุงู ุนูู ุงููุดููุฉ:

**ุงูููุชุฌ**: ููุจ ูุงุก
- **ุงููุฑููุฉ**: ูุทุนุฉ โ ุจุงููุช (10 ูุทุน) โ ูุฑุชูู (10 ุจุงููุช = 100 ูุทุนุฉ)

**ุงููุงุชูุฑุฉ**:
1. ููุจ ูุงุก - ูุทุนุฉ - ุณุนุฑ: 5 ุฏููุงุฑ
2. ููุจ ูุงุก - ุจุงููุช - ุณุนุฑ: 50 ุฏููุงุฑ (10 ูุทุน)
3. ููุจ ูุงุก - ูุฑุชูู - ุณุนุฑ: 500 ุฏููุงุฑ (100 ูุทุนุฉ)

**ุงููุดููุฉ ุงููุฏููุฉ**:
- ุงููุธุงู ูุญุฏุซ ุณุนุฑ ุงูุชูููุฉ 3 ูุฑุงุช:
  1. ูุญุฏุซ ุฅูู 5 ุฏููุงุฑ (ูู ุงูุจูุฏ ุงูุฃูู)
  2. ูุญุฏุซ ุฅูู 50 ุฏููุงุฑ (ูู ุงูุจูุฏ ุงูุซุงูู) โ
  3. ูุญุฏุซ ุฅูู 500 ุฏููุงุฑ (ูู ุงูุจูุฏ ุงูุซุงูุซ) โโโ

**ุงููุชูุฌุฉ**: ุณุนุฑ ุงููุทุนุฉ ูุตุจุญ 500 ุฏููุงุฑ ุจุฏูุงู ูู 5 ุฏููุงุฑ!

## ุงูุญู ุงููุทุจู:

### 1. **ุชุฌููุน ุงูุจููุฏ ุญุณุจ ุงูููุชุฌ**
```dart
final Map<int, List<SupplierInvoiceItem>> itemsByProduct = {};
for (var item in items) {
  if (item.productId != null) {
    itemsByProduct.putIfAbsent(item.productId!, () => []).add(item);
  }
}
```

### 2. **ุงุฎุชูุงุฑ ุงูุจูุฏ ุงูุฃูุถู ููุชุญุฏูุซ**
```dart
// ุฃููููุฉ ููุจูุฏ ุจูุญุฏุฉ "ูุทุนุฉ"
SupplierInvoiceItem? bestItem;
for (var item in productItems) {
  if (item.unit == 'ูุทุนุฉ') {
    bestItem = item;
    break;
  }
}
bestItem ??= productItems.first; // ุฅุฐุง ูู ููุฌุฏุ ูุณุชุฎุฏู ุฃูู ุจูุฏ
```

### 3. **ุชุญุฏูุซ ุงูุณุนุฑ ูุฑุฉ ูุงุญุฏุฉ ููุท**
- ูุชู ุชุญุฏูุซ ุณุนุฑ ูู ููุชุฌ **ูุฑุฉ ูุงุญุฏุฉ ููุท**
- ูุชู ุงุณุชุฎุฏุงู ุงูุจูุฏ ุจูุญุฏุฉ "ูุทุนุฉ" ุฅุฐุง ูุงู ููุฌูุฏุงู
- ุฅุฐุง ูู ููุฌุฏ ุจูุฏ ุจูุญุฏุฉ "ูุทุนุฉ"ุ ูุชู ุงุณุชุฎุฏุงู ุฃูู ุจูุฏ

## ูุซุงู ุนูู ุงูุณุฌูุงุช ุงูุฌุฏูุฏุฉ:

### ูุจู ุงูุฅุตูุงุญ:
```
๐ฆ ุนุฏุฏ ุงูุจููุฏ ุงููุณุชุฑุฌุนุฉ: 3

--- ูุนุงูุฌุฉ ุจูุฏ: ููุจ ูุงุก ---
  unitPrice: 5.0
  unit: ูุทุนุฉ
  ๐ฐ ุงูุชูููุฉ ุงููุฏููุฉ: 5.0
  ๐ฐ ุงูุชูููุฉ ุงูุฌุฏูุฏุฉ: 5.0
  โญ๏ธ ุชุฎุทู: ุงูุณุนุฑ ูู ูุชุบูุฑ

--- ูุนุงูุฌุฉ ุจูุฏ: ููุจ ูุงุก ---
  unitPrice: 5.0
  unit: ุจุงููุช
  ๐ฐ ุงูุชูููุฉ ุงููุฏููุฉ: 5.0
  ๐ฐ ุงูุชูููุฉ ุงูุฌุฏูุฏุฉ: 5.0
  โญ๏ธ ุชุฎุทู: ุงูุณุนุฑ ูู ูุชุบูุฑ

--- ูุนุงูุฌุฉ ุจูุฏ: ููุจ ูุงุก ---
  unitPrice: 5.0
  unit: ูุฑุชูู
  ๐ฐ ุงูุชูููุฉ ุงููุฏููุฉ: 5.0
  ๐ฐ ุงูุชูููุฉ ุงูุฌุฏูุฏุฉ: 5.0
  โญ๏ธ ุชุฎุทู: ุงูุณุนุฑ ูู ูุชุบูุฑ
```

### ุจุนุฏ ุงูุฅุตูุงุญ:
```
๐ฆ ุนุฏุฏ ุงูุจููุฏ ุงููุณุชุฑุฌุนุฉ: 3
๐ ุนุฏุฏ ุงูููุชุฌุงุช ุงููุฑูุฏุฉ: 1

--- ูุนุงูุฌุฉ ููุชุฌ ID: 123 ---
  ุนุฏุฏ ุงูุจููุฏ ููุฐุง ุงูููุชุฌ: 3
  - ุจูุฏ: ููุจ ูุงุก, ูุญุฏุฉ: ูุทุนุฉ, ุณุนุฑ: 5.0
    โ ุชู ุงุฎุชูุงุฑ ูุฐุง ุงูุจูุฏ (ูุญุฏุฉ ูุทุนุฉ)
  - ุจูุฏ: ููุจ ูุงุก, ูุญุฏุฉ: ุจุงููุช, ุณุนุฑ: 5.0
  - ุจูุฏ: ููุจ ูุงุก, ูุญุฏุฉ: ูุฑุชูู, ุณุนุฑ: 5.0
  ๐ ุงูุจูุฏ ุงููุฎุชุงุฑ: ููุจ ูุงุก
  unitPrice: 5.0
  unit: ูุทุนุฉ
  ๐ฐ ุงูุชูููุฉ ุงููุฏููุฉ: 5.0
  ๐ฐ ุงูุชูููุฉ ุงูุฌุฏูุฏุฉ: 5.0
  โญ๏ธ ุชุฎุทู: ุงูุณุนุฑ ูู ูุชุบูุฑ
```

## ุงูููุงุฆุฏ:

โ **ุชุญุฏูุซ ูุงุญุฏ ููุท**: ูู ููุชุฌ ููุญุฏุซ ูุฑุฉ ูุงุญุฏุฉ ููุท
โ **ุฃููููุฉ ูููุทุนุฉ**: ูุชู ุงุณุชุฎุฏุงู ุณุนุฑ ุงููุทุนุฉ ุฅุฐุง ูุงู ููุฌูุฏุงู
โ **ุชุฌูุจ ุงูุฃุฎุทุงุก**: ูุง ูุชู ุชุญุฏูุซ ุงูุณุนุฑ ุจุณุนุฑ ุงููุฑุชูู/ุงูุจุงููุช
โ **ุณุฌูุงุช ูุงุถุญุฉ**: ููููู ุฑุคูุฉ ุฃู ุจูุฏ ุชู ุงุฎุชูุงุฑู ููุชุญุฏูุซ

## ููุงุญุธุฉ ูููุฉ:

**ุณุนุฑ ุงููุทุนุฉ ููุญุณุจ ุจุดูู ุตุญูุญ ูู ุงูููุฏ ุงูุญุงูู**:
```dart
// ูู _AddItemDialog
if (_selectedUnit == 'ูุทุนุฉ') {
  unitPricePerPiece = totalPriceForUnit;
} else {
  final unitQty = _unitQuantities[_selectedUnit] ?? 1;
  unitPricePerPiece = totalPriceForUnit / unitQty;
}

final item = SupplierInvoiceItem(
  unitPrice: unitPricePerPiece, // ุณุนุฑ ุงููุทุนุฉ ุงููุงุญุฏุฉ โ
  unit: _selectedUnit,
);
```

ูุฐููุ `item.unitPrice` ูุญุชูู ุฏุงุฆูุงู ุนูู **ุณุนุฑ ุงููุทุนุฉ**ุ ุญุชู ูู ูุงูุช ุงููุญุฏุฉ ุงููุณุชุฎุฏูุฉ ูู ุงููุงุชูุฑุฉ ูู "ูุฑุชูู".

## ุงููููุงุช ุงููุนุฏูุฉ:
- `lib/services/suppliers_service.dart`

## ุงูุชุญุณููุงุช ุงููุณุชูุจููุฉ:

ููุชุนุงูู ูุน ุญุงูุงุช ุฃูุซุฑ ุชุนููุฏุงู (ูุซู "ุชุนุจุฆุฉ 24 ูุทุนุฉ" ูู ุงุณู ุงูููุชุฌ)ุ ูููู ุฅุถุงูุฉ:

1. **ุงุณุชุฎุฑุงุฌ ุงูุชุนุจุฆุฉ ูู ุงุณู ุงูููุชุฌ**:
   ```dart
   // ูุซุงู: "ููุจ ูุงุก ุชุนุจุฆุฉ 24 ูุทุนุฉ"
   final packingMatch = RegExp(r'ุชุนุจุฆุฉ?\s*(\d+)').firstMatch(productName);
   if (packingMatch != null) {
     final packing = int.parse(packingMatch.group(1)!);
     // ุงุณุชุฎุฏุงู ูุฐุง ุงูุฑูู ูู ุงูุญุณุงุจุงุช
   }
   ```

2. **ุชุญููู ุงููููุฉ ูุงูุชุนุจุฆุฉ**:
   ```dart
   // ูุซุงู: "ุงูุชุนุจุฆุฉ 8 ูุทุน ุงููููุฉ 32"
   // ูุนูู: 32 รท 8 = 4 ูุฑุงุชูู
   ```

3. **ุชุญุณูู ุงูุฐูุงุก ุงูุงุตุทูุงุนู**:
   - ุชุฏุฑูุจ ุงููููุฐุฌ ุนูู ููู ุฃููุงุท ุงูุชุนุจุฆุฉ ุงููุฎุชููุฉ
   - ุงุณุชุฎุฑุงุฌ ูุนูููุงุช ุงูุชุนุจุฆุฉ ุชููุงุฆูุงู ูู ุงููุงุชูุฑุฉ

## ุงูุฎูุงุตุฉ:

ุงูุขู ุงููุธุงู ูุญุฏุซ ุณุนุฑ ูู ููุชุฌ **ูุฑุฉ ูุงุญุฏุฉ ููุท**ุ ููุนุทู ุฃููููุฉ ููุจูุฏ ุจูุญุฏุฉ "ูุทุนุฉ" ูุถูุงู ุฏูุฉ ุงูุฃุณุนุงุฑ.
