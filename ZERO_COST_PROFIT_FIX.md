# ุฅุตูุงุญ ุญุณุงุจ ุงูุฃุฑุจุงุญ ููููุชุฌุงุช ุจุชูููุฉ ุตูุฑ โ

## ุงููุดููุฉ ุงูุฃุตููุฉ
ุนูุฏูุง ุชููู ุชูููุฉ ุงูููุชุฌ ุตูุฑุ ูุงู ุงูุจุฑูุงูุฌ ูุญุณุจ ุงูุฑุจุญ = 100% ูู ุณุนุฑ ุงูุจูุน (ุฎุทุฃ!)

**ูุซุงู:**
- ููุชุฌ ุจุณุนุฑ 100,000 ุฏููุงุฑ ูุชูููุฉ 0
- **ูุจู ุงูุฅุตูุงุญ:** ุงูุฑุจุญ = 100,000 ุฏููุงุฑ (100%)
- **ุจุนุฏ ุงูุฅุตูุงุญ:** ุงูุฑุจุญ = 10,000 ุฏููุงุฑ (10%)

## ุงูุญู ุงููุทุจู
ุฅุฐุง ูุงูุช ุงูุชูููุฉ ุตูุฑุ ูููุชุฑุถ ุฃู ุงูุฑุจุญ 10% ููุท ูู ุณุนุฑ ุงูุจูุน (ุงูุชูููุฉ = 90%)

## ุงููููุงุช ุงูููุตูุญุฉ

### 1. `lib/services/database_service.dart` (13 ุฅุตูุงุญ)

#### ุงุณุชุนูุงูุงุช SQL (5 ููุงูุน):
- `getCustomerProfitData` - ุญุณุงุจ ุฃุฑุจุงุญ ุงูุนููู
- `getCustomerYearlyData` - ุฃุฑุจุงุญ ุงูุนููู ุงูุณูููุฉ
- `getCustomerMonthlyData` - ุฃุฑุจุงุญ ุงูุนููู ุงูุดูุฑูุฉ
- `getProductYearlyProfit` - ุฃุฑุจุงุญ ุงูููุชุฌ ุงูุณูููุฉ
- `getProductMonthlyProfit` - ุฃุฑุจุงุญ ุงูููุชุฌ ุงูุดูุฑูุฉ

#### ุฏูุงู Dart (8 ููุงูุน):
- `getMonthlySalesSummary` - ุงูุฌุฑุฏ ุงูุดูุฑู
- `getProductSalesData` - ุชูุงุฑูุฑ ุงูุจุถุงุนุฉ
- `getProductInvoicesForMonth` - ููุงุชูุฑ ุงูููุชุฌ ุงูุดูุฑูุฉ
- `getCustomerInvoicesWithProfitForMonth` - ููุงุชูุฑ ุงูุนููู
- ุญุณุงุจ ุงูุฑุจุญ ููููุชุฌุงุช ุงููุจุงุนุฉ ุจุงููุชุฑ/ููุฉ (ูููุนูู)

### 2. `lib/services/ai_chat_service.dart` (4 ุฅุตูุงุญุงุช)
- `getDailyReport` - ุงูุชูุฑูุฑ ุงููููู
- `getWeeklyReport` - ุงูุชูุฑูุฑ ุงูุฃุณุจูุนู
- `_getSalesSummary` - ููุฎุต ุงููุจูุนุงุช
- `_generateProfitReport` - ุชูุฑูุฑ ุงูุฃุฑุจุงุญ

### 3. `lib/screens/create_invoice_screen.dart` (1 ุฅุตูุงุญ)
- `_calculateProfit` - ุญุณุงุจ ุงูุฑุจุญ ูู ุดุงุดุฉ ุฅูุดุงุก ุงููุงุชูุฑุฉ

## ุงูุดุงุดุงุช ุงูููุญุณููุฉ

### ๐ ุงูุชูุงุฑูุฑ
- โ ุงูุฌุฑุฏ ุงูุดูุฑู (`inventory_screen.dart`)
- โ ุงูุชูุฑูุฑ ุงููููู (`daily_report_screen.dart`)
- โ ุงูุชูุฑูุฑ ุงูุฃุณุจูุนู (`weekly_report_screen.dart`)
- โ ุชูุงุฑูุฑ ุงูุจุถุงุนุฉ (`product_reports_screen.dart`)
- โ ุชูุงุฑูุฑ ุงูุฃุดุฎุงุต (`people_reports_screen.dart`)

### ๐ ุงูุชูุงุตูู
- โ ุชูุงุตูู ุงูููุชุฌ (`product_details_screen.dart`)
- โ ุชูุงุตูู ุงูุนููู (`customer_details_screen.dart`)
- โ ุชูุงุตูู ุงูุดูุฑ/ุงูุณูุฉ ููููุชุฌ
- โ ุชูุงุตูู ุงูุดูุฑ/ุงูุณูุฉ ููุนููู

### ๐ค ุงูุฐูุงุก ุงูุงุตุทูุงุนู
- โ ุงูุฏุฑุฏุดุฉ ุงูุฐููุฉ
- โ ุงูุชูุงุฑูุฑ ุงูุชููุงุฆูุฉ

### ๐ ุงูููุงุชูุฑ
- โ ุดุงุดุฉ ุฅูุดุงุก ุงููุงุชูุฑุฉ (ุนุฑุถ ุงูุฑุจุญ)

## ุงูููุฏ ุงููุฑุฌุนู

### ูู SQL:
```sql
CASE 
  WHEN COALESCE(ii.actual_cost_price, ii.cost_price, p.cost_price, 0) > 0 
  THEN (ii.applied_price - COALESCE(ii.actual_cost_price, ii.cost_price, p.cost_price, 0))
  ELSE ii.applied_price * 0.10
END
```

### ูู Dart:
```dart
if (costPrice <= 0 && sellingPrice > 0) {
  costPrice = MoneyCalculator.getEffectiveCost(0, sellingPrice);
}
```

## ุงุฎุชุจุงุฑ ุงูุฅุตูุงุญ

### ูุจู ุงูุฅุตูุงุญ:
```
ููุชุฌ: 100,000 ุฏููุงุฑุ ุชูููุฉ: 0
ุงูุฑุจุญ ุงููุญุณูุจ: 100,000 ุฏููุงุฑ (ุฎุทุฃ!)
```

### ุจุนุฏ ุงูุฅุตูุงุญ:
```
ููุชุฌ: 100,000 ุฏููุงุฑุ ุชูููุฉ: 0
ุงูุชูููุฉ ุงููุนููุฉ: 90,000 ุฏููุงุฑ (90%)
ุงูุฑุจุญ ุงููุญุณูุจ: 10,000 ุฏููุงุฑ (10%) โ
```

## ููุงุญุธุงุช ูููุฉ

1. **ุงูููุชุฌุงุช ุฐุงุช ุงูุชูููุฉ ุงููุญุฏุฏุฉ ูู ุชุชุฃุซุฑ** - ุงูุฅุตูุงุญ ูุคุซุฑ ููุท ุนูู ุงูููุชุฌุงุช ุจุชูููุฉ ุตูุฑ
2. **ูุณุจุฉ ุงูุฑุจุญ ุงูููุชุฑุถุฉ 10%** - ูููู ุชุนุฏูููุง ูู `money_calculator.dart`
3. **ุงููุธุงู ุงููุฑูู ูุฏุนูู** - ูุนูู ูุน ุงููุทุนุฉ/ุจุงููุช/ูุฑุชูู ูุงููุชุฑ/ููุฉ
