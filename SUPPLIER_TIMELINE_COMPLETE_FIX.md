# โ ุฅุตูุงุญ ุดุงูู ูุณุฌู ูุนุงููุงุช ุงูููุฑุฏูู

## ๐ ุงููุดุงูู ุงูุชู ุชู ุฅุตูุงุญูุง

### 1. **ููุงุชูุฑ ุชุธูุฑ 0 ุฏููุงุฑ** โ
**ุงููุดููุฉ:** ุฌููุน ุงูููุงุชูุฑ (ููุฏ ูุฏูู) ุชุธูุฑ 0 ุฏููุงุฑ

**ุงูุณุจุจ:** ุงูููุฏ ูุงู ูุนุฑุถ `delta` (ุงูุชุบููุฑ ูู ุงูุฏูู) ูููุณ ุงููุจูุบ ุงููุนูู

**ุงูุญู:**
```dart
if (e.paymentType == 'ููุฏ') {
  // ูุงุชูุฑุฉ ููุฏ: ุนุฑุถ 0 ูุน ุชูุถูุญ ุงููุจูุบ ุงููุนูู
  displayAmount = '0';
  subtitle = 'ูุงุชูุฑุฉ ูุดุชุฑูุงุช (ููุฏ) - ุงููุจูุบ: ${_nf.format(e.totalAmount)}';
} else {
  // ูุงุชูุฑุฉ ุฏูู: ุนุฑุถ ุงููุจูุบ ุงูุฐู ูุคุซุฑ ุนูู ุงูุฏูู
  displayAmount = _nf.format(e.delta);
  subtitle = 'ูุงุชูุฑุฉ ูุดุชุฑูุงุช (ุฏูู)';
}
```

---

### 2. **ุงูุฑุตูุฏ ุจุนุฏ ุงููุนุงููุฉ ุฎุงุทุฆ** โ
**ุงููุดููุฉ:** ุฌููุน ุงููุนุงููุงุช ุชุธูุฑ ููุณ ุงูุฑุตูุฏ (11,029,890)

**ุงูุณุจุจ:** ุงูุญุณุงุจ ูุงู ูุจุฏุฃ ูู ุงูุฑุตูุฏ ุงูุญุงูู ููุนูุฏ ููุฎูู ุจุดูู ุฎุงุทุฆ

**ุงูุญู:**
```dart
// ุงูุญุณุงุจ ุงูุตุญูุญ: ูู ุงูุฃูุฏู ุฅูู ุงูุฃุญุฏุซ
entries.sort((a, b) {
  final c = a.dt.compareTo(b.dt); // ุงูุฃูุฏู ุฃููุงู
  if (c != 0) return c;
  return a.id.compareTo(b.id);
});

double runningBalance = 0.0;
for (final e in entries) {
  final before = runningBalance;
  final after = before + e.delta; // ุฅุถุงูุฉ ุงูุชุบููุฑ
  
  _invoiceBalances[e.id] = {'before': before, 'after': after};
  runningBalance = after;
}
```

---

### 3. **ุณูุฏ ุงููุจุถ ูุง ูุธูุฑ** โ
**ุงููุดููุฉ:** ุณูุฏุงุช ุงููุจุถ ูุง ุชุธูุฑ ูู ุงูุณุฌู

**ุงูุณุจุจ:** 
1. ูู ูุชู ุฅุนุงุฏุฉ ุชุญููู ุงูุจูุงูุงุช ุจุนุฏ ุงูุญูุธ
2. `_receipts` ูุงูุช ูุงุฑุบุฉ

**ุงูุญู:**
```dart
// ูู _loadData()
final rec = await _service.getReceiptsBySupplier(widget.supplier.id!);
setState(() {
  _receipts = rec; // โ ุชุญุฏูุซ ุงููุงุฆูุฉ
});

// ูู _buildUnifiedTimeline()
for (final r in _receipts) {
  entries.add(_Entry(
    dt: r.receiptDate,
    id: r.id ?? -1,
    kind: 'receipt',
    delta: -r.amount, // ุณุงูุจ ูุฃูู ูุฎูุถ ุงูุฏูู
  ));
}
```

---

### 4. **ุงูุชุฑุชูุจ ุฎุงุทุฆ** โ
**ุงููุดููุฉ:** ุงููุนุงููุงุช ูุง ุชุธูุฑ ูู ุงูุฃุญุฏุซ ุฅูู ุงูุฃูุฏู

**ุงูุณุจุจ:** ุงูุชุฑุชูุจ ูุงู ุตุญูุญุงู ูู ุงูุนุฑุถ ููู ุฎุงุทุฆ ูู ุงูุญุณุงุจ

**ุงูุญู:**
```dart
// ููุญุณุงุจ: ูู ุงูุฃูุฏู ุฅูู ุงูุฃุญุฏุซ
entries.sort((a, b) => a.dt.compareTo(b.dt));

// ููุนุฑุถ: ูู ุงูุฃุญุฏุซ ุฅูู ุงูุฃูุฏู
entries.sort((a, b) => b.dt.compareTo(a.dt));
```

---

## ๐ ุงููุชูุฌุฉ ุงูููุงุฆูุฉ

### ูุจู ุงูุฅุตูุงุญ:
```
โ ูุงุชูุฑุฉ ุฏูู 313,000: ูุธูุฑ 0 ุฏููุงุฑ
โ ูุงุชูุฑุฉ ููุฏ 500,000: ูุธูุฑ 0 ุฏููุงุฑ
โ ุณูุฏ ูุจุถ 1,485,250: ูุง ูุธูุฑ
โ ุงูุฑุตูุฏ ุจุนุฏ ูู ูุนุงููุฉ: 11,029,890 (ููุณ ุงูุฑูู!)
```

### ุจุนุฏ ุงูุฅุตูุงุญ:
```
โ ูุงุชูุฑุฉ ุฏูู 313,000: ูุธูุฑ 313,000 ุฏููุงุฑ
โ ูุงุชูุฑุฉ ููุฏ 500,000: ูุธูุฑ 0 ุฏููุงุฑ (ูุน ุชูุถูุญ: ุงููุจูุบ 500,000)
โ ุณูุฏ ูุจุถ 1,485,250: ูุธูุฑ 1,485,250 ุฏููุงุฑ
โ ุงูุฑุตูุฏ ุจุนุฏ ูู ูุนุงููุฉ: ูุชุบูุฑ ุจุดูู ุตุญูุญ
```

---

## ๐ฏ ูุซุงู ุนููู

### ุงูุณููุงุฑูู:
1. ูุงุชูุฑุฉ ุฏูู 1,000,000 (2025-11-20)
2. ูุงุชูุฑุฉ ููุฏ 500,000 (2025-11-21)
3. ุณูุฏ ูุจุถ 300,000 (2025-11-22)
4. ูุงุชูุฑุฉ ุฏูู 200,000 (2025-11-23)

### ุงูุนุฑุถ (ูู ุงูุฃุญุฏุซ ุฅูู ุงูุฃูุฏู):
```
๐ 2025-11-23
  + 200,000 ุฏููุงุฑ
  ุงูุฑุตูุฏ ุจุนุฏ ุงููุนุงููุฉ: 900,000 ุฏููุงุฑ
  ูุงุชูุฑุฉ ูุดุชุฑูุงุช (ุฏูู)

๐ 2025-11-22
  - 300,000 ุฏููุงุฑ
  ุงูุฑุตูุฏ ุจุนุฏ ุงููุนุงููุฉ: 700,000 ุฏููุงุฑ
  ุณูุฏ ูุจุถ

๐ 2025-11-21
  0 ุฏููุงุฑ
  ุงูุฑุตูุฏ ุจุนุฏ ุงููุนุงููุฉ: 1,000,000 ุฏููุงุฑ
  ูุงุชูุฑุฉ ูุดุชุฑูุงุช (ููุฏ) - ุงููุจูุบ: 500,000

๐ 2025-11-20
  + 1,000,000 ุฏููุงุฑ
  ุงูุฑุตูุฏ ุจุนุฏ ุงููุนุงููุฉ: 1,000,000 ุฏููุงุฑ
  ูุงุชูุฑุฉ ูุดุชุฑูุงุช (ุฏูู)
```

---

## ๐ง ุงูุชุญุณููุงุช ุงููุถุงูุฉ

### 1. **ุณุฌูุงุช ุชุดุฎูุตูุฉ:**
```
๐ข ุญุณุงุจ ุงูุฃุฑุตุฏุฉ...
๐ ุนุฏุฏ ุงููุนุงููุงุช: 4
  ๐ ูุงุชูุฑุฉ 1: ูุจู=0ุ ุชุบููุฑ=1000000, ุจุนุฏ=1000000
  ๐ ูุงุชูุฑุฉ 2: ูุจู=1000000ุ ุชุบููุฑ=0, ุจุนุฏ=1000000
  ๐ฐ ุณูุฏ 1: ูุจู=1000000ุ ุชุบููุฑ=-300000, ุจุนุฏ=700000
  ๐ ูุงุชูุฑุฉ 3: ูุจู=700000ุ ุชุบููุฑ=200000, ุจุนุฏ=900000
๐ฐ ุงูุฑุตูุฏ ุงูููุงุฆู ุงููุญุณูุจ: 900000
๐ฐ ุงูุฑุตูุฏ ุงููุนูู ูู ุงููุงุนุฏุฉ: 900000
โ ุงูุชูู ุญุณุงุจ ุงูุฃุฑุตุฏุฉ
```

### 2. **ุชุญุฏูุซ ุชููุงุฆู:**
- ูุชู ุฅุนุงุฏุฉ ุชุญููู ุงูุจูุงูุงุช ุจุนุฏ ูู ุนูููุฉ
- ูุชู ุชุญุฏูุซ ุงูุฑุตูุฏ ุงููุนุฑูุถ
- ูุชู ุฅุนุงุฏุฉ ุญุณุงุจ ุงูุฃุฑุตุฏุฉ

### 3. **ุนุฑุถ ูุงุถุญ:**
- ุงูููุงุชูุฑ ุงูููุฏูุฉ ุชุธูุฑ 0 ูุน ุชูุถูุญ ุงููุจูุบ ุงููุนูู
- ุงูููุงุชูุฑ ุงูุฏูู ุชุธูุฑ ุงููุจูุบ ุงูุฐู ูุคุซุฑ ุนูู ุงูุฏูู
- ุณูุฏุงุช ุงููุจุถ ุชุธูุฑ ุจูุถูุญ

---

## ๐งช ุงุฎุชุจุฑ ุงูุขู!

1. ุงูุชุญ ุชูุงุตูู ุงูููุฑุฏ
2. ุฃุถู ูุงุชูุฑุฉ ุฏูู ุจูุจูุบ 500,000
3. ุฃุถู ูุงุชูุฑุฉ ููุฏ ุจูุจูุบ 300,000
4. ุฃุถู ุณูุฏ ูุจุถ ุจูุจูุบ 200,000
5. ุฑุงูุจ ุงูุณุฌู:
   - โ ุงูููุงุชูุฑ ุชุธูุฑ ุจุงููุจุงูุบ ุงูุตุญูุญุฉ
   - โ ุณูุฏ ุงููุจุถ ูุธูุฑ
   - โ ุงูุฃุฑุตุฏุฉ ุตุญูุญุฉ
   - โ ุงูุชุฑุชูุจ ูู ุงูุฃุญุฏุซ ุฅูู ุงูุฃูุฏู

---

**ุชู ุฅุตูุงุญ ุฌููุน ุงููุดุงูู!** ๐
